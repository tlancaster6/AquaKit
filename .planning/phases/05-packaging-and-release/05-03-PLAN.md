---
phase: 05-packaging-and-release
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/rewiring/REWIRING.md
autonomous: true

must_haves:
  truths:
    - "Rewiring guide lists every AquaCal import with its AquaCore replacement"
    - "Rewiring guide lists every AquaMVS import with its AquaCore replacement"
    - "Rewiring guide flags modules NOT ported with explanation"
    - "A developer can migrate a file by find-and-replace using the import table"
  artifacts:
    - path: ".planning/rewiring/REWIRING.md"
      provides: "Complete import migration guide"
      min_lines: 100
  key_links:
    - from: ".planning/rewiring/REWIRING.md"
      to: "src/aquacore/__init__.py"
      via: "all new imports must be valid aquacore exports"
      pattern: "from aquacore import"
---

<objective>
Write the rewiring guide that maps every old AquaCal and AquaMVS import to its AquaCore replacement.

Purpose: Consumer teams (AquaCal, AquaMVS) need a find-and-replace reference to migrate their imports. The guide also documents intentional gaps (modules not ported to AquaCore).
Output: `.planning/rewiring/REWIRING.md`
</objective>

<execution_context>
@C:/Users/tucke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/tucke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-packaging-and-release/05-RESEARCH.md
@src/aquacore/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify AquaCore public API against research mapping</name>
  <files></files>
  <action>
1. Read `src/aquacore/__init__.py` and collect all exports from `__all__`.

2. Read the AquaCal source to verify import paths. Check these directories exist and scan for public exports:
   - `../AquaCal/src/aquacal/core/refractive_geometry.py`
   - `../AquaCal/src/aquacal/utils/transforms.py`
   - `../AquaCal/src/aquacal/config/schema.py`
   - `../AquaCal/src/aquacal/io/serialization.py`
   - `../AquaCal/src/aquacal/io/video.py`
   - `../AquaCal/src/aquacal/io/images.py`
   - `../AquaCal/src/aquacal/io/frameset.py`
   - `../AquaCal/src/aquacal/triangulation/`
   - `../AquaCal/src/aquacal/core/interface_model.py`

3. Read the AquaMVS source for the same:
   - `../AquaMVS/src/aquamvs/calibration.py`
   - `../AquaMVS/src/aquamvs/triangulation.py` or `../AquaMVS/src/aquamvs/triangulation/`
   - `../AquaMVS/src/aquamvs/projection/`

4. Cross-reference actual function signatures where the research mapping says "signature changed". Note the key differences: numpy vs torch, single vs batched, return type changes (None vs valid_mask).

5. Read `src/aquacore/camera.py` to verify `create_camera` signature for the guide (research open question #6).

If AquaCal or AquaMVS source directories don't exist at the expected paths, use the research mapping tables as the authoritative source. The research already read these files.
  </action>
  <verify>All exports in `__init__.py.__all__` are accounted for in the mapping; all research mappings are verified or confirmed from research</verify>
  <done>Complete verified mapping of old imports to new imports, with signature differences noted</done>
</task>

<task type="auto">
  <name>Task 2: Write the rewiring guide</name>
  <files>.planning/rewiring/REWIRING.md</files>
  <action>
Create `.planning/rewiring/REWIRING.md` with this structure (per user decision: structured by consumer, lives in .planning/rewiring/):

```markdown
# AquaCore Rewiring Guide

## Prerequisites
- Install PyTorch separately (aquacore does not declare torch as a dependency)
- Install aquacore: `pip install aquacore`

## AquaCal Users

### Quick Reference: Import Replacement Table
| Old Import | New Import | Notes |
|---|---|---|
(one row per ported function/class from AquaCal mapping)

### Signature Changes
For each function where the signature changed meaningfully (numpy->torch, different return type, different parameter names), provide a brief before/after example showing the key difference. Use Claude's discretion on depth — focus on the non-obvious changes:
- Return type changes: `None` for TIR → `(zeros, False)` valid_mask pattern
- Input type changes: numpy arrays → torch tensors
- Batching: single-point → batched
- `load_calibration` → `load_calibration_data` (different name AND different return type)
- `triangulate_point` → `triangulate_rays` (different API shape)

### NOT PORTED (AquaCal modules with no AquaCore equivalent)
List each unported module with a one-line description of what it does and why it's not ported (calibration-specific, detection-specific, etc.).

## AquaMVS Users

### Quick Reference: Import Replacement Table
| Old Import | New Import | Notes |
|---|---|---|
(one row per ported function/class from AquaMVS mapping)

### NOT PORTED (AquaMVS modules with no AquaCore equivalent)
List each unported module with explanation.
```

Key constraints per user decisions:
- Structured by consumer (AquaCal section, AquaMVS section) -- LOCKED
- Lives in `.planning/rewiring/` -- LOCKED
- Covers ported imports AND flags gaps -- LOCKED
- Depth of examples: Claude's discretion based on actual API differences
  </action>
  <verify>File exists at `.planning/rewiring/REWIRING.md`; every export in `aquacore.__all__` appears at least once in the guide; both AquaCal and AquaMVS sections present; NOT PORTED sections present</verify>
  <done>Rewiring guide is complete with import tables, signature change examples, and gap documentation for both AquaCal and AquaMVS consumers</done>
</task>

</tasks>

<verification>
- `.planning/rewiring/REWIRING.md` exists and has 100+ lines
- Every item in `aquacore.__all__` appears in at least one import table
- AquaCal section has import table + signature changes + NOT PORTED
- AquaMVS section has import table + NOT PORTED
- NOT PORTED sections list all intentional gaps from research
</verification>

<success_criteria>
A developer can open the rewiring guide, find their old import in the table, and see the exact new import to use. Signature changes are documented where non-obvious. Intentional gaps are clearly flagged.
</success_criteria>

<output>
After completion, create `.planning/phases/05-packaging-and-release/05-03-SUMMARY.md`
</output>
